#!/bin/bash
# =============================================================================
# DATA-DRIVEN FONT INSTALLER (Updated with Nerd Font Support)
# =============================================================================
{{- $osid := .osid }}
{{- $role := .role }}

{{- if ne $role "server" }}
set -euo pipefail

echo "=== ðŸ”¤ Installing Developer Fonts ==="
echo "OS ID: {{ $osid }} | Role: {{ $role }}"

# -----------------------------------------------------------------------------
# ARCH LINUX
# -----------------------------------------------------------------------------
{{- if eq $osid "arch" }}
echo "Checking Arch Linux fonts..."
sudo pacman -S --needed --noconfirm ttf-meslo-nerd ttf-fira-code ttf-victor-mono-nerd
# ... (rest of your existing Arch logic) ...

# -----------------------------------------------------------------------------
# POP!_OS / DEBIAN / UBUNTU
# -----------------------------------------------------------------------------
{{- else if or (eq $osid "pop") (eq $osid "debian") }}
echo "Checking Pop!_OS/Debian fonts..."
sudo apt-get update
sudo apt-get install -y fonts-firacode fonts-noto-mono fonts-cascadia-code

# MANUAL NERD FONT INSTALL (Crucial for Starship icons)
FONT_DIR="$HOME/.local/share/fonts/jetbrains-mono-nerd"
if [ ! -d "$FONT_DIR" ]; then
    echo "ðŸ“¦ Downloading JetBrains Mono Nerd Font (Manual Install)..."
    mkdir -p "$FONT_DIR"
    URL="https://github.com/ryanoasis/nerd-fonts/releases/latest/download/JetBrainsMono.zip"
    curl -L "$URL" -o /tmp/jb_nerd.zip
    unzip -o /tmp/jb_nerd.zip -d "$FONT_DIR"
    rm /tmp/jb_nerd.zip
    # Clean up non-font files
    find "$FONT_DIR" -type f ! -name "*.ttf" ! -name "*.otf" -delete
fi

# -----------------------------------------------------------------------------
# macOS (DARWIN)
# -----------------------------------------------------------------------------
{{- else if eq $osid "darwin" }}
echo "Checking macOS fonts..."
# Note: cask-fonts is deprecated in favor of homebrew-cask
brew install --cask font-fira-code-nerd-font font-meslo-lg-nerd-font
{{- end }}

# -----------------------------------------------------------------------------
# FINALIZE
# -----------------------------------------------------------------------------
if command -v fc-cache >/dev/null 2>&1; then
    echo "ðŸ”„ Rebuilding font cache..."
    fc-cache -f
fi

echo "âœ… Font installation complete!"
{{- end }}
